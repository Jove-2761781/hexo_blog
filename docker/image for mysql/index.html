<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/blog/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Hexo" href="https://jove-2761781.github.io/blog/rss.xml"><link rel="alternate" type="application/atom+xml" title="Hexo" href="https://jove-2761781.github.io/blog/atom.xml"><link rel="alternate" type="application/json" title="Hexo" href="https://jove-2761781.github.io/blog/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/blog/css/app.css?v=0.2.5"><link rel="canonical" href="https://jove-2761781.github.io/blog/docker/image%20for%20mysql/"><title>image for mysql | Yume Shoka = Hexo = subtitle</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">image for mysql</h1><div class="meta"><span class="item" title="创建时间：2023-02-06 22:06:32"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-02-06T22:06:32+08:00">2023-02-06</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>10k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>9 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/blog/" rel="start">Yume Shoka</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/d757e4c9c546cd7dba16ee5e23dc2d9d.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/f85e0c5cc31d609ad0b6e48a88040ecb.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/49cf7ea74f1d26f437088b2b244ba417.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/cc1a734b8a0734243d5071644d60f360.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/31105e606c74614c7f8f7b1d08e1619a.jpg"></li><li class="item" data-background-image="https://img.timelessq.com/images/2022/07/26/2b0a8c81d91579602eee343aff82c4c9.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/blog/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://jove-2761781.github.io/blog/docker/image%20for%20mysql/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/blog/images/avatar.jpg"><meta itemprop="name" content="Jove"><meta itemprop="description" content="subtitle, 个人博客"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Hexo"></span><div class="body md" itemprop="articleBody"><ul><li></li></ul><hr><p>title: Image for MySQL</p><hr><h1 id="image-for-mysql"><a class="anchor" href="#image-for-mysql">#</a> Image for MySQL</h1><p><strong>example:</strong></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> mysql_wiki <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">-v</span> /home/jove/mysql/wiki/data:/var/lib/mysql <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token parameter variable">-v</span> /home/jove/mysql/wiki/conf:/etc/mysql/conf.d <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token parameter variable">-e</span> <span class="token assign-left variable">MYSQL_ROOT_PASSWORD</span><span class="token operator">=</span>wiki@123 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token parameter variable">-e</span> <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>C.UTF-8 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token parameter variable">-p</span> <span class="token number">3306</span>:3306 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="7"></td><td><pre>mysql:latest</pre></td></tr></table></figure><h1 id="how-to-use-this-image"><a class="anchor" href="#how-to-use-this-image">#</a> How to use this image</h1><h2 id="start-a-mysql-server-instance"><a class="anchor" href="#start-a-mysql-server-instance">#</a> Start a  <code>mysql</code>  server instance</h2><p>Starting a MySQL instance is simple:</p><pre><code class="language-console">$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre><p>... where  <code>some-mysql</code>  is the name you want to assign to your container,  <code>my-secret-pw</code>  is the password to be set for the MySQL root user and  <code>tag</code>  is the tag specifying the MySQL version you want. See the list above for relevant tags.</p><h2 id="connect-to-mysql-from-the-mysql-command-line-client"><a class="anchor" href="#connect-to-mysql-from-the-mysql-command-line-client">#</a> Connect to MySQL from the MySQL command line client</h2><p>The following command starts another  <code>mysql</code>  container instance and runs the  <code>mysql</code>  command line client against your original  <code>mysql</code>  container, allowing you to execute SQL statements against your database instance:</p><pre><code class="language-console">$ docker run -it --network some-network --rm mysql mysql -hsome-mysql -uexample-user -p
</code></pre><p>... where  <code>some-mysql</code>  is the name of your original  <code>mysql</code>  container (connected to the  <code>some-network</code>  Docker network).</p><p>This image can also be used as a client for non-Docker or remote instances:</p><pre><code class="language-console">$ docker run -it --rm mysql mysql -hsome.mysql.host -usome-mysql-user -p
</code></pre><p>More information about the MySQL command line client can be found in the <span class="exturl" data-url="aHR0cDovL2Rldi5teXNxbC5jb20vZG9jL2VuL215c3FsLmh0bWw=">MySQL documentation</span></p><h2 id="via-docker-stack-deploy-or-docker-compose"><a class="anchor" href="#via-docker-stack-deploy-or-docker-compose">#</a> via <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/stack_deploy/"><code>docker stack deploy</code> </a>or <a target="_blank" rel="noopener" href="https://github.com/docker/compose"><code>docker-compose</code></a></h2><p>Example  <code>stack.yml</code>  for  <code>mysql</code> :</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># Use root/example as user/password credentials</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3.1'</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token key atrule">db</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql</pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment"># NOTE: use of "mysql_native_password" is not recommended: https://dev.mysql.com/doc/refman/8.0/en/upgrading-from-previous-series.html#upgrade-caching-sha2-password</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># (this is just an example, not intended to be a production configuration)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>default<span class="token punctuation">-</span>authentication<span class="token punctuation">-</span>plugin=mysql_native_password</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> example</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token key atrule">adminer</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> adminer</pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token punctuation">-</span> 8080<span class="token punctuation">:</span><span class="token number">8080</span></pre></td></tr></table></figure><p>Run  <code>docker stack deploy -c stack.yml mysql</code>  (or  <code>docker-compose -f stack.yml up</code> ), wait for it to initialize completely, and visit  <code>http://swarm-ip:8080</code> ,  <code>http://localhost:8080</code> , or  <code>http://host-ip:8080</code>  (as appropriate).</p><h2 id="container-shell-access-and-viewing-mysql-logs"><a class="anchor" href="#container-shell-access-and-viewing-mysql-logs">#</a> Container shell access and viewing MySQL logs</h2><p>The  <code>docker exec</code>  command allows you to run commands inside a Docker container. The following command line will give you a bash shell inside your  <code>mysql</code>  container:</p><pre><code class="language-console">$ docker exec -it some-mysql bash
</code></pre><p>The log is available through Docker's container log:</p><pre><code class="language-console">$ docker logs some-mysql
</code></pre><h2 id="using-a-custom-mysql-configuration-file"><a class="anchor" href="#using-a-custom-mysql-configuration-file">#</a> Using a custom MySQL configuration file</h2><p>The default configuration for MySQL can be found in  <code>/etc/mysql/my.cnf</code> , which may  <code>!includedir</code>  additional directories such as  <code>/etc/mysql/conf.d</code>  or  <code>/etc/mysql/mysql.conf.d</code> . Please inspect the relevant files and directories within the  <code>mysql</code>  image itself for more details.</p><p>If  <code>/my/custom/config-file.cnf</code>  is the path and name of your custom configuration file, you can start your  <code>mysql</code>  container like this (note that only the directory path of the custom config file is used in this command):</p><pre><code class="language-console">$ docker run --name some-mysql -v /my/custom:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre><p>This will start a new container  <code>some-mysql</code>  where the MySQL instance uses the combined startup settings from  <code>/etc/mysql/my.cnf</code>  and  <code>/etc/mysql/conf.d/config-file.cnf</code> , with settings from the latter taking precedence.</p><h3 id="configuration-without-a-cnf-file"><a class="anchor" href="#configuration-without-a-cnf-file">#</a> Configuration without a  <code>cnf</code>  file</h3><p>Many configuration options can be passed as flags to  <code>mysqld</code> . This will give you the flexibility to customize the container without needing a  <code>cnf</code>  file. For example, if you want to change the default encoding and collation for all tables to use UTF-8 ( <code>utf8mb4</code> ) just run the following:</p><pre><code class="language-console">$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
</code></pre><p>If you would like to see a complete list of available options, just run:</p><pre><code class="language-console">$ docker run -it --rm mysql:tag --verbose --help
</code></pre><h2 id="environment-variables"><a class="anchor" href="#environment-variables">#</a> Environment Variables</h2><p>When you start the  <code>mysql</code>  image, you can adjust the configuration of the MySQL instance by passing one or more environment variables on the  <code>docker run</code>  command line. Do note that none of the variables below will have any effect if you start the container with a data directory that already contains a database: any pre-existing database will always be left untouched on container startup.</p><p>See also <span class="exturl" data-url="aHR0cHM6Ly9kZXYubXlzcWwuY29tL2RvYy9yZWZtYW4vNS43L2VuL2Vudmlyb25tZW50LXZhcmlhYmxlcy5odG1s">MySQL :: MySQL 5.7 Reference Manual :: 4.9 Environment Variables</span> for documentation of environment variables which MySQL itself respects (especially variables like  <code>MYSQL_HOST</code> , which is known to cause issues when used with this image).</p><h3 id="mysql_root_password"><a class="anchor" href="#mysql_root_password">#</a> <code>MYSQL_ROOT_PASSWORD</code></h3><p>This variable is mandatory and specifies the password that will be set for the MySQL  <code>root</code>  superuser account. In the above example, it was set to  <code>my-secret-pw</code> .</p><h3 id="mysql_database"><a class="anchor" href="#mysql_database">#</a> <code>MYSQL_DATABASE</code></h3><p>This variable is optional and allows you to specify the name of a database to be created on image startup. If a user/password was supplied (see below) then that user will be granted superuser access (<a target="_blank" rel="noopener" href="http://dev.mysql.com/doc/en/adding-users.html">corresponding to  <code>GRANT ALL</code> </a>) to this database.</p><h3 id="mysql_user-mysql_password"><a class="anchor" href="#mysql_user-mysql_password">#</a> <code>MYSQL_USER</code> ,  <code>MYSQL_PASSWORD</code></h3><p>These variables are optional, used in conjunction to create a new user and to set that user's password. This user will be granted superuser permissions (see above) for the database specified by the  <code>MYSQL_DATABASE</code>  variable. Both variables are required for a user to be created.</p><p>Do note that there is no need to use this mechanism to create the root superuser, that user gets created by default with the password specified by the  <code>MYSQL_ROOT_PASSWORD</code>  variable.</p><h3 id="mysql_allow_empty_password"><a class="anchor" href="#mysql_allow_empty_password">#</a> <code>MYSQL_ALLOW_EMPTY_PASSWORD</code></h3><p>This is an optional variable. Set to a non-empty value, like  <code>yes</code> , to allow the container to be started with a blank password for the root user. <em>NOTE</em>: Setting this variable to  <code>yes</code>  is not recommended unless you really know what you are doing, since this will leave your MySQL instance completely unprotected, allowing anyone to gain complete superuser access.</p><h3 id="mysql_random_root_password"><a class="anchor" href="#mysql_random_root_password">#</a> <code>MYSQL_RANDOM_ROOT_PASSWORD</code></h3><p>This is an optional variable. Set to a non-empty value, like  <code>yes</code> , to generate a random initial password for the root user (using  <code>pwgen</code> ). The generated root password will be printed to stdout ( <code>GENERATED ROOT PASSWORD: .....</code> ).</p><h3 id="mysql_onetime_password"><a class="anchor" href="#mysql_onetime_password">#</a> <code>MYSQL_ONETIME_PASSWORD</code></h3><p>Sets root (<em>not</em> the user specified in  <code>MYSQL_USER</code> !) user as expired once init is complete, forcing a password change on first login. Any non-empty value will activate this setting. <em>NOTE</em>: This feature is supported on MySQL 5.6+ only. Using this option on MySQL 5.5 will throw an appropriate error during initialization.</p><h3 id="mysql_initdb_skip_tzinfo"><a class="anchor" href="#mysql_initdb_skip_tzinfo">#</a> <code>MYSQL_INITDB_SKIP_TZINFO</code></h3><p>By default, the entrypoint script automatically loads the timezone data needed for the  <code>CONVERT_TZ()</code>  function. If it is not needed, any non-empty value disables timezone loading.</p><h2 id="docker-secrets"><a class="anchor" href="#docker-secrets">#</a> Docker Secrets</h2><p>As an alternative to passing sensitive information via environment variables,  <code>_FILE</code>  may be appended to the previously listed environment variables, causing the initialization script to load the values for those variables from files present in the container. In particular, this can be used to load passwords from Docker secrets stored in  <code>/run/secrets/&lt;secret_name&gt;</code>  files. For example:</p><pre><code class="language-console">$ docker run --name some-mysql -e MYSQL_ROOT_PASSWORD_FILE=/run/secrets/mysql-root -d mysql:tag
</code></pre><p>Currently, this is only supported for  <code>MYSQL_ROOT_PASSWORD</code> ,  <code>MYSQL_ROOT_HOST</code> ,  <code>MYSQL_DATABASE</code> ,  <code>MYSQL_USER</code> , and  <code>MYSQL_PASSWORD</code> .</p><h1 id="initializing-a-fresh-instance"><a class="anchor" href="#initializing-a-fresh-instance">#</a> Initializing a fresh instance</h1><p>When a container is started for the first time, a new database with the specified name will be created and initialized with the provided configuration variables. Furthermore, it will execute files with extensions  <code>.sh</code> ,  <code>.sql</code>  and  <code>.sql.gz</code>  that are found in  <code>/docker-entrypoint-initdb.d</code> . Files will be executed in alphabetical order. You can easily populate your  <code>mysql</code>  services by <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLyNtb3VudC1hLWhvc3QtZmlsZS1hcy1hLWRhdGEtdm9sdW1l">mounting a SQL dump into that directory</span> and provide <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vcmVmZXJlbmNlL2J1aWxkZXIv">custom images</span> with contributed data. SQL files will be imported by default to the database specified by the  <code>MYSQL_DATABASE</code>  variable.</p><h1 id="caveats"><a class="anchor" href="#caveats">#</a> Caveats</h1><h2 id="where-to-store-data"><a class="anchor" href="#where-to-store-data">#</a> Where to Store Data</h2><p>Important note: There are several ways to store data used by applications that run in Docker containers. We encourage users of the  <code>mysql</code>  images to familiarize themselves with the options available, including:</p><ul><li>Let Docker manage the storage of your database data <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLyNhZGRpbmctYS1kYXRhLXZvbHVtZQ==">by writing the database files to disk on the host system using its own internal volume management</span>. This is the default and is easy and fairly transparent to the user. The downside is that the files may be hard to locate for tools and applications that run directly on the host system, i.e. outside containers.</li><li>Create a data directory on the host system (outside the container) and <span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmRvY2tlci5jb20vZW5naW5lL3R1dG9yaWFscy9kb2NrZXJ2b2x1bWVzLyNtb3VudC1hLWhvc3QtZGlyZWN0b3J5LWFzLWEtZGF0YS12b2x1bWU=">mount this to a directory visible from inside the container</span>. This places the database files in a known location on the host system, and makes it easy for tools and applications on the host system to access the files. The downside is that the user needs to make sure that the directory exists, and that e.g. directory permissions and other security mechanisms on the host system are set up correctly.</li></ul><p>The Docker documentation is a good starting point for understanding the different storage options and variations, and there are multiple blogs and forum postings that discuss and give advice in this area. We will simply show the basic procedure here for the latter option above:</p><ol><li><p>Create a data directory on a suitable volume on your host system, e.g.  <code>/my/own/datadir</code> .</p></li><li><p>Start your  <code>mysql</code>  container like this:</p><pre><code class="language-console">$ docker run --name some-mysql -v /my/own/datadir:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre></li></ol><p>The  <code>-v /my/own/datadir:/var/lib/mysql</code>  part of the command mounts the  <code>/my/own/datadir</code>  directory from the underlying host system as  <code>/var/lib/mysql</code>  inside the container, where MySQL by default will write its data files.</p><h2 id="no-connections-until-mysql-init-completes"><a class="anchor" href="#no-connections-until-mysql-init-completes">#</a> No connections until MySQL init completes</h2><p>If there is no database initialized when the container starts, then a default database will be created. While this is the expected behavior, this means that it will not accept incoming connections until such initialization completes. This may cause issues when using automation tools, such as  <code>docker-compose</code> , which start several containers simultaneously.</p><p>If the application you're trying to connect to MySQL does not handle MySQL downtime or waiting for MySQL to start gracefully, then putting a connect-retry loop before the service starts might be necessary. For an example of such an implementation in the official images, see <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci1saWJyYXJ5L3dvcmRwcmVzcy9ibG9iLzFiNDhiNGJjY2Q3YWRiMGY3ZWExNDMxYzdiNDcwYTQwZTE4NmYzZGEvZG9ja2VyLWVudHJ5cG9pbnQuc2gjTDE5NS1MMjM1">WordPress</span> or <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2RvY2tlci1saWJyYXJ5L2RvY3MvYmxvYi85NjYwYTBjY2NiODdkOGRiODQyZjMzYmMwNTc4ZDc2OWNhYWYzYmE5L2Jvbml0YS9zdGFjay55bWwjTDI4LUw0NA==">Bonita</span>.</p><h2 id="usage-against-an-existing-database"><a class="anchor" href="#usage-against-an-existing-database">#</a> Usage against an existing database</h2><p>If you start your  <code>mysql</code>  container instance with a data directory that already contains a database (specifically, a  <code>mysql</code>  subdirectory), the  <code>$MYSQL_ROOT_PASSWORD</code>  variable should be omitted from the run command line; it will in any case be ignored, and the pre-existing database will not be changed in any way.</p><h2 id="running-as-an-arbitrary-user"><a class="anchor" href="#running-as-an-arbitrary-user">#</a> Running as an arbitrary user</h2><p>If you know the permissions of your directory are already set appropriately (such as running against an existing database, as described above) or you have need of running  <code>mysqld</code>  with a specific UID/GID, it is possible to invoke this image with  <code>--user</code>  set to any value (other than  <code>root</code> / <code>0</code> ) in order to achieve the desired access/configuration:</p><pre><code class="language-console">$ mkdir data
$ ls -lnd data
drwxr-xr-x 2 1000 1000 4096 Aug 27 15:54 data
$ docker run -v &quot;$PWD/data&quot;:/var/lib/mysql --user 1000:1000 --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag
</code></pre><h2 id="creating-database-dumps"><a class="anchor" href="#creating-database-dumps">#</a> Creating database dumps</h2><p>Most of the normal tools will work, although their usage might be a little convoluted in some cases to ensure they have access to the  <code>mysqld</code>  server. A simple way to ensure this is to use  <code>docker exec</code>  and run the tool from the same container, similar to the following:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysqldump --all-databases -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> <span class="token operator">></span> /some/path/on/your/host/all-databases.sql</pre></td></tr></table></figure><h2 id="restoring-data-from-dump-files"><a class="anchor" href="#restoring-data-from-dump-files">#</a> Restoring data from dump files</h2><p>For restoring data. You can use  <code>docker exec</code>  command with  <code>-i</code>  flag, similar to the following:</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-i</span> some-mysql <span class="token function">sh</span> <span class="token parameter variable">-c</span> <span class="token string">'exec mysql -uroot -p"$MYSQL_ROOT_PASSWORD"'</span> <span class="token operator">&lt;</span> /some/path/on/your/host/all-databases.sql</pre></td></tr></table></figure></div><footer><div class="meta"><span id="docker/image for mysql/" class="item leancloud_visitors" data-flag-title="image for mysql" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/blog/images/wechatpay.png" alt="Jove 微信支付"><p>微信支付</p></div><div><img data-src="/blog/images/alipay.png" alt="Jove 支付宝"><p>支付宝</p></div><div><img data-src="/blog/images/paypal.png" alt="Jove 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Jove <i class="ic i-at"><em>@</em></i>Hexo</li><li class="link"><strong>本文链接：</strong> <a href="https://jove-2761781.github.io/blog/docker/image%20for%20mysql/" title="image for mysql">https://jove-2761781.github.io/blog/docker/image for mysql/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/blog/docker/commands/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;dcd5178b4c81cd15d7465af2a33c0d6d.jpg" title="commands"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>commands</h3></a></div><div class="item right"><a href="/blog/docker/install%20on%20Fedora/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;img.timelessq.com&#x2F;images&#x2F;2022&#x2F;07&#x2F;26&#x2F;662d37b8a580b466da309ec795b7ae55.jpg" title="install on Fedora"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>install on Fedora</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#image-for-mysql"><span class="toc-number">1.</span> <span class="toc-text">Image for MySQL</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#how-to-use-this-image"><span class="toc-number">2.</span> <span class="toc-text">How to use this image</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#start-a-mysql-server-instance"><span class="toc-number">2.1.</span> <span class="toc-text">Start a  mysql  server instance</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#connect-to-mysql-from-the-mysql-command-line-client"><span class="toc-number">2.2.</span> <span class="toc-text">Connect to MySQL from the MySQL command line client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#via-docker-stack-deploy-or-docker-compose"><span class="toc-number">2.3.</span> <span class="toc-text">via  docker stack deploy  or  docker-compose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#container-shell-access-and-viewing-mysql-logs"><span class="toc-number">2.4.</span> <span class="toc-text">Container shell access and viewing MySQL logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#using-a-custom-mysql-configuration-file"><span class="toc-number">2.5.</span> <span class="toc-text">Using a custom MySQL configuration file</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#configuration-without-a-cnf-file"><span class="toc-number">2.5.1.</span> <span class="toc-text">Configuration without a  cnf  file</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#environment-variables"><span class="toc-number">2.6.</span> <span class="toc-text">Environment Variables</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_root_password"><span class="toc-number">2.6.1.</span> <span class="toc-text">MYSQL_ROOT_PASSWORD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_database"><span class="toc-number">2.6.2.</span> <span class="toc-text">MYSQL_DATABASE</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_user-mysql_password"><span class="toc-number">2.6.3.</span> <span class="toc-text">MYSQL_USER ,  MYSQL_PASSWORD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_allow_empty_password"><span class="toc-number">2.6.4.</span> <span class="toc-text">MYSQL_ALLOW_EMPTY_PASSWORD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_random_root_password"><span class="toc-number">2.6.5.</span> <span class="toc-text">MYSQL_RANDOM_ROOT_PASSWORD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_onetime_password"><span class="toc-number">2.6.6.</span> <span class="toc-text">MYSQL_ONETIME_PASSWORD</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql_initdb_skip_tzinfo"><span class="toc-number">2.6.7.</span> <span class="toc-text">MYSQL_INITDB_SKIP_TZINFO</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-secrets"><span class="toc-number">2.7.</span> <span class="toc-text">Docker Secrets</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#initializing-a-fresh-instance"><span class="toc-number">3.</span> <span class="toc-text">Initializing a fresh instance</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#caveats"><span class="toc-number">4.</span> <span class="toc-text">Caveats</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#where-to-store-data"><span class="toc-number">4.1.</span> <span class="toc-text">Where to Store Data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#no-connections-until-mysql-init-completes"><span class="toc-number">4.2.</span> <span class="toc-text">No connections until MySQL init completes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usage-against-an-existing-database"><span class="toc-number">4.3.</span> <span class="toc-text">Usage against an existing database</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#running-as-an-arbitrary-user"><span class="toc-number">4.4.</span> <span class="toc-text">Running as an arbitrary user</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#creating-database-dumps"><span class="toc-number">4.5.</span> <span class="toc-text">Creating database dumps</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#restoring-data-from-dump-files"><span class="toc-number">4.6.</span> <span class="toc-text">Restoring data from dump files</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Jove" data-src="/blog/images/avatar.jpg"><p class="name" itemprop="name">Jove</p><div class="description" itemprop="description">个人博客</div></div><nav class="state"><div class="item posts"><a href="/blog/archives/"><span class="count">108</span> <span class="name">文章</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWU=" title="https:&#x2F;&#x2F;github.com&#x2F;amehime"><i class="ic i-github"></i></span> <span class="exturl item twitter" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9hbWVoaW1l" title="https:&#x2F;&#x2F;twitter.com&#x2F;amehime"><i class="ic i-twitter"></i></span> <span class="exturl item zhihu" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3Blb3BsZS9ydXJpc216aw==" title="https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;rurismzk"><i class="ic i-zhihu"></i></span> <span class="exturl item music" data-url="aHR0cHM6Ly9tdXNpYy4xNjMuY29tLyMvdXNlci9ob21lP2lkPTEyODg2ODIz" title="https:&#x2F;&#x2F;music.163.com&#x2F;#&#x2F;user&#x2F;home?id&#x3D;12886823"><i class="ic i-cloud-music"></i></span> <span class="exturl item weibo" data-url="aHR0cHM6Ly93ZWliby5jb20vYW1laGltZQ==" title="https:&#x2F;&#x2F;weibo.com&#x2F;amehime"><i class="ic i-weibo"></i></span> <span class="exturl item about" data-url="aHR0cHM6Ly9hYm91dC5tZS9hbWVoaW1l" title="https:&#x2F;&#x2F;about.me&#x2F;amehime"><i class="ic i-address-card"></i></span></div><ul class="menu"><li class="item"><a href="/blog/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/blog/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/blog/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/blog/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/blog/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/blog/docker/commands/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/blog/docker/install%20on%20Fedora/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/blog/rhel/diskmgmt/iscsi%20share/" title="iscsi share">iscsi share</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/update/patch%20p32226239/" title="patch p32226239">patch p32226239</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/installation/udev/" title="udev">udev</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/installation/preinstall-10g%20for%20centos%207.9/" title="preinstall-10g for centos 7">preinstall-10g for centos 7</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/rman/restore/" title="restore">restore</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/maintenance/configuration/table/" title="table">table</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/architecture/architecture/" title="architecture">architecture</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/update/patch%20p20299014/" title="patch p20299014">patch p20299014</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/trobuleshooting/rac/ORA-17503/" title="ORA-17503">ORA-17503</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/blog/oracle/duplication/active%20database%20duplication/" title="active database duplication">active database duplication</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Jove @ Yume Shoka</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">320k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">4:51</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"docker/image for mysql/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/blog/js/app.js?v=0.2.5"></script></body></html>